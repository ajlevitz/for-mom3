<h1><%= @school.name %></h1>

<% if user_signed_in? && current_user.admin? %>
  <%= render :partial => 'admin' %>
<% elsif user_signed_in? && !current_user.admin? %>
  <% if !current_user.schools.find_by id: @school.id %>
    <h2><%= link_to 'Apply here', {:controller => 'applyings', :action => 'apply_here', :school_id => @school.id}, :method => :get %></h2>
  <% end %>
  <%= render :partial => 'student' %>
<% end %>

<p><%= link_to '<< GO HOME', root_url %></p>

<% if user_signed_in? && current_user.admin? %>
  <h2>Students applying here:</h2>
  <% if @school.users.length > 0 %>
    <ul>
      <% @school.users.each do |user| %>
        <li><%= link_to user.name, user_path(user) %></li>
      <% end %>
    </ul>
  <% else %>
    <p><i>No one has yet chosen to apply here</i></p>
  <% end %>
<% end %>

<h2>Essay prompts</h2>
<% if @school.prompts.length == 0 %>
  <p><i>You haven't added any prompts for this school</i></p>
<% end %>

<% @school.prompts.each do |prompt| %>
  <p>
    <strong><%= prompt.question %></strong>
    <% prompt.responses.each do |response| %>
      <p><%= response.comments %></p>
    <% end %>
    <%= form_for(Response.new) do |f| %>
      <p>
        <%= f.label "Add a response: " %><%= f.text_field :comments %>
      </p>
      <p style="visibility:hidden; height:0px;">
        <%= f.label :user_id %><%= f.text_field :user_id, :value => current_user.id %>
      </p>
      <p style="visibility:hidden; height:0px;">
        <%= f.label :prompt_id %><%= f.text_field :prompt_id, :value => prompt.id %>
      </p>
      <p>
        <%= f.submit %>
      </p>
    <% end %>
  </p>
  </br>
<% end %>

<%= form_for([@school, @school.prompts.build]) do |f| %>
  <p>
    <%= f.label 'Add a prompt:' %><br />
    <%= f.text_area :question, :size => "30x10" %>
  </p>
  <p>
    <%= f.submit %>
  </p>
<% end %>
